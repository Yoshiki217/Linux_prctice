# 20241118 Linux 勉強

## SSH Trouble Shooting
- Trouble : SSHをダウンロードしたのに、restartが効かない問題が発生。　しかも、rebootするとログインさえできない。
    ```
    root@ubuntu:~# systemctl restart ssh
    Job for ssh.service failed because the control process exited with error code.
    See "systemctl status ssh.service" and "journalctl -xeu ssh.service" for details.
    ```
    ```
    root@ubuntu:~# systemctl status ssh
        × ssh.service - OpenBSD Secure Shell server
        Loaded: loaded (/usr/lib/systemd/system/ssh.service; enabled; preset: enab>
        Active: failed (Result: exit-code) since Mon 2024-11-18 10:16:03 KST; 8s a>
        TriggeredBy: × ssh.socket
        Docs: man:sshd(8)
             man:sshd_config(5)
        Process: 5869 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=1/FAILURE)
        CPU: 5ms
    ```

- How to Resolve : https://blog.msalt.net/326
    + まず、慌てずDebug Logを確認してみよう。
      ### `/usr/sbin/sshd -ddd`
      ```
      debug1: sshd version OpenSSH_9.6, OpenSSL 3.0.13 30 Jan 2024
      debug1: Unable to load host key "/etc/ssh/ssh_host_rsa_key": error in libcrypto
      debug1: Unable to load host key: /etc/ssh/ssh_host_rsa_key
      debug1: Unable to load host key "/etc/ssh/ssh_host_ecdsa_key": error in libcrypto
      debug1: Unable to load host key: /etc/ssh/ssh_host_ecdsa_key
      debug1: Unable to load host key "/etc/ssh/ssh_host_ed25519_key": error in libcrypto
      debug1: Unable to load host key: /etc/ssh/ssh_host_ed25519_key
      sshd: no hostkeys available -- exiting.
      ```
    + ホストキーのロードができないというエラーを確認。
      hostkeyを作ってあげたら（僕の場合はoverwrite)、解決するだろう。
      ```
      ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
      ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
      ```
    sshをrestartした後、Xshellで接続できるか確認。しっかりつながる！

## Ubuntu DB Server
### 目標：Windows10からmysql databaseに接続できるようにすること。
### 事前準備
- > apt -y install net-tools ssh gedit bzip2
- ufw allow ssh およびssh接続

### MySQL インストール
- apt update
- apt -y install mysql-server mysql-client
    => サーバーとクライアント機能両方インストール（TEST用）
- restart, enable mysql
- ufw allow 3306, ufw reload

### MySQL User生成
- alter user 'root'@'localhost' identified with caching_sha2_password by '4321' ;
- exit
- mysql -u root -p (4321)

### 外部(Windows10)からの接続
=> 外部からの接続は基本的に遮断。許可する必要あり
- apt -y install vim
- vim /etc/mysql/mysql.conf.d/mysqld.cnf
```shell
31 bind-address            = 127.0.0.1
32 mysqlx-bind-address     = 127.0.0.1
```
ローカルのみの接続許可という意味。bind-addressの前に#をつけて無効化。
```shell
# 31 bind-address            = 127.0.0.1
32 mysqlx-bind-address     = 127.0.0.1
```
- mysql restart
- WindowsにMySQL Shellをインストール
![winuser](/202411/pic/mysqlwin.png)
    + Ubuntu>mysql
        + create user winuser@'192.168.111.%' identified by '4321';
        + grant all ON *.* to winuser@'192.168.111.%';
    + Windows10>mysql-shell
        + \connect --mysql --user winuser --host 192.168.111.101

### MySQL DATABASE 作成
```

CREATE DATABASE shopping_db;

show databases;

USE shopping_db;

CREATE TABLE customer(
	id VARCHAR(10) NOT NULL PRIMARY KEY ,
	name VARCHAR(5),
	age INT,
	address VARCHAR(5) );


CREATE TABLE purchase(
	no INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	cust_id VARCHAR(10) ,
	date CHAR(8) ,
	product VARCHAR(5)  );

INSERT INTO customer VALUES ( 'jisoo' , '지수', 29, '경기');
INSERT INTO customer VALUES ( 'jennie' , '제니', 28, '서울');
INSERT INTO customer VALUES ( 'lisa' , '리사', 27, '태국');
INSERT INTO customer VALUES ( 'rose' , '로제', 27, '호주');

INSERT INTO purchase VALUES ( null, 'jisoo' , '20270122', 'TV');
INSERT INTO purchase VALUES ( null, 'lisa' , '20270211', 'TV');
INSERT INTO purchase VALUES ( null, 'rose' , '20270211', '휴대폰');
INSERT INTO purchase VALUES ( null, 'jisoo' , '20270222', '스마트워치');
INSERT INTO purchase VALUES ( null, 'rose' , '20270311', '아이패드');
```
> select * from customer;
> select * from purchase; 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　